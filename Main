package Visual;

import java.util.ArrayList;
import java.util.Scanner;

import Teatregrama.Espectador;
import Teatregrama.Obra;
import Teatregrama.Sessio;

public class Main {

    private static Scanner teclat = new Scanner(System.in);

    private static ArrayList<Obra> obres = new ArrayList<Obra>();
    private static ArrayList<Sessio> sessions = new ArrayList<Sessio>();
    private static ArrayList<Espectador> espectadors = new ArrayList<Espectador>();

    private static final String[] OPCIONS = { "Crea una Sessió nova", "Mostrar Sessions existents",
            "Modificar una Sessió", "Crea una Obra",
            "Mostrar Obres existents", "Modificar una Obra", "Registrar nous Espectadors",
            "Assignar un Espectador a una Sessió",
            "Mostrar pati de butaques", "Sortir" };

    public static void main(String[] args) {
        boolean end = false;
        int opcioEscollida;

        while (!end) {
            generarMenu();
            opcioEscollida = escollirOpcio();

            switch (opcioEscollida) {
                case 1:
                    try {
                        System.out.println(crearSessio().toString());
                    } catch (NullPointerException ex) {
                    }
                    break;

                case 2:
                    mostrarSessions();
                    break;

                case 3:
                    mostrarSessions();
                    System.out.print("[?] Escull una Sessió per modificar: ");
                    opcioEscollida = (teclat.nextInt() - 1);
                    System.out.println();
                    if (opcioEscollida >= 0 && opcioEscollida < sessions.size())
                        modificarSessio(sessions.get(opcioEscollida));
                    else
                        System.out.println("[!] L'opció escollida no es correspon amb ninguna Sessió");
                    break;

                case 4:
                    System.out.println(crearObra().toString());
                    break;

                case 5:
                    mostrarObres();
                    break;

                case 6:
                    mostrarObres();
                    System.out.print("[?] Escull una Obra per modificar: ");
                    opcioEscollida = (teclat.nextInt() - 1);
                    System.out.println();
                    if (opcioEscollida >= 0 && opcioEscollida < obres.size()) {
                        modificarObra(obres.get(opcioEscollida));
                    } else {
                        System.out.println("[!] L'opció escollida no es correspon amb ninguna Obra");
                    }
                    break;

                case 7:
                    System.out.println(registrarEspectador().toString());
                    break;

                case 8:
                    Espectador espectador;
                    Sessio sessio;
                    int fila, butaca;

                    mostrarEspectadors();
                    System.out.print("[?] Escull un Espectador a assignar a una Sessió: ");
                    opcioEscollida = (teclat.nextInt() - 1);
                    System.out.println();
                    if (opcioEscollida >= 0 && opcioEscollida < espectadors.size()) {
                        espectador = espectadors.get(opcioEscollida);
                        mostrarSessions();
                        System.out.print(
                                "[?] Escull la Sessió en què serà assignada l'Espectador " + espectador.getNom()
                                        + ": ");
                        opcioEscollida = (teclat.nextInt() - 1);
                        System.out.println();
                        if (opcioEscollida >= 0 && opcioEscollida < sessions.size()) {
                            sessio = sessions.get(opcioEscollida);

                            System.out.println("[i] Actualment aquesta Sessió disposa de " + sessio.getSeients().length
                                    + " Fileres i " + sessio.getSeients()[0].length + " Butaques");
                            System.out.print(
                                    "[?] Escull la filera on s'asseurà l'Espectador " + espectador.getNom() + ": ");
                            opcioEscollida = teclat.nextInt();
                            System.out.println();
                            if (opcioEscollida > 0 && opcioEscollida <= sessio.getSeients().length) {
                                fila = opcioEscollida;

                                System.out.print(
                                        "[?] Escull la butaca on s'asseurà l'Espectador " + espectador.getNom() + ": ");
                                opcioEscollida = teclat.nextInt();
                                System.out.println();
                                if (opcioEscollida > 0 && opcioEscollida <= sessio.getSeients()[0].length) {
                                    butaca = opcioEscollida;

                                    assignarEspectador(sessio, espectador, fila, butaca);
                                } else
                                    System.out.println("[!] La Butaca escollida no existeix en aquesta Sessió");
                            } else
                                System.out.println("[!] La Filera escollida no existeix en aquesta Sessió");
                        } else
                            System.out.println("[!] L'opció escollida no es correspon amb ninguna Sessió");
                    } else
                        System.out.println("[!] L'opció escollida no es correspon amb ningun Espectador");
                    break;

                case 9:
                    mostrarSessions();
                    System.out.print("[?] Escull una Sessió per a mostrar el Pati de Butaques: ");
                    opcioEscollida = (teclat.nextInt() - 1);
                    System.out.println();
                    if (opcioEscollida < 0 || opcioEscollida >= sessions.size()) {
                        System.out.println("[!] L'opció escollida no es correspon amb ninguna de les Sessións");
                    } else {
                        Sessio sessio_escollida = sessions.get(opcioEscollida);
                        String butaques = "";

                        for (int i = 0; i < sessio_escollida.getSeients().length; i++) {
                            for (int j = 0; j < sessio_escollida.getSeients()[0].length; j++) {
                                if (sessio_escollida.getSeients()[i][j] != null) {
                                    butaques += "X ";
                                } else {
                                    butaques += "O ";
                                }
                            }
                            butaques += "\n";
                        }

                        System.out.println(butaques);
                    }
                    break;

                case 10:
                    end = true;
                    System.out.println("[i] Fins aviat!");
                    break;
            }
        }
    }

    private static void generarMenu() {
        System.out.println("========================================");
        for (int i = 0; i < OPCIONS.length; i++) {
            System.out.println("    " + (i + 1) + ". " + OPCIONS[i]);
        }
        System.out.println("========================================");
    }

    private static int escollirOpcio() {
        int opcio;
        boolean error = false;
        System.out.print("[?] Escull una opció del menu: ");
        opcio = teclat.nextInt();

        if (opcio <= 0 || opcio > OPCIONS.length)
            error = true;

        while (error) {
            System.out.print("[!?] Escull una opció vàlida: ");
            opcio = teclat.nextInt();

            if (opcio > 0 && opcio <= OPCIONS.length)
                error = false;
        }
        System.out.println();

        return opcio;
    }

    private static void mostrarSessions() {
        System.out.println("========================================");
        for (int a = 0; a < sessions.size(); a++) {
            System.out.println("    " + (a + 1) + ". " + sessions.get(a).toString());
        }
        System.out.println("========================================");
    }

    private static void mostrarObres() {
        System.out.println("========================================");
        for (int a = 0; a < obres.size(); a++) {
            System.out.println("    " + (a + 1) + ". " + obres.get(a).toString());
        }
        System.out.println("========================================");
    }

    private static void mostrarEspectadors() {
        System.out.println("========================================");
        for (int a = 0; a < espectadors.size(); a++) {
            System.out.println("    " + (a + 1) + ". " + espectadors.get(a).toString());
        }
        System.out.println("========================================");
    }

    private static Sessio crearSessio() {
        Obra obra;
        double preu;
        String hora, dia;
        int fila, columna, opcio;

        if (obres.isEmpty())
            System.out.println("[!] Has de crear com a mínim una Obra per a poder assignar-la");
        else {
            mostrarObres();
            System.out.print("[?] Escull una Obra a assignar: ");
            opcio = (teclat.nextInt() - 1);

            if (opcio < 0 || opcio >= obres.size()) {
                System.out.println("[!] L'opció escollida no es correspon amb ninguna Obra");
                return null;
            } else {
                obra = obres.get(opcio);
            }

            System.out.println();
            System.out.print("[?] Escull el preu de la Sessió: ");
            preu = teclat.nextDouble();
            System.out.println();
            System.out.print("[?] Escull el dia de la Sessió: ");
            dia = teclat.next();
            System.out.println();
            System.out.print("[?] Escull l'hora de la Sessió: ");
            hora = teclat.next();
            System.out.println();
            System.out.print("[?] Escull el número de fileres de les butaques: ");
            fila = teclat.nextInt();
            System.out.println();
            System.out.print("[?] Escull el número de columnes de les butaques: ");
            columna = teclat.nextInt();
            System.out.println();

            Sessio sessio = new Sessio(obra, preu, hora, dia, fila, columna);
            sessions.add(sessio);

            return sessio;
        }

        return null;
    }

    private static Obra crearObra() {
        String titol, autor, edat;
        int durada;
        boolean mEdat = false;

        System.out.println();
        System.out.print("[?] Escull el títol de l'Obra: ");
        titol = teclat.next();
        System.out.println();
        System.out.print("[?] Escull l'autor de l'Obra: ");
        autor = teclat.next();
        System.out.println();
        System.out.print("[?] Escull la durada de l'Obra: ");
        durada = teclat.nextInt();
        System.out.println();
        System.out.print(
                "[?] Escull si l'Obra és per a majors d'edat ('s' en cas afirmatiu, qualsevol altre en cas contrari): ");
        edat = teclat.next();
        if (edat.equalsIgnoreCase("s"))
            mEdat = true;
        System.out.println();

        Obra obra = new Obra(titol, durada, autor, mEdat);
        obres.add(obra);

        return obra;
    }

    private static void modificarSessio(Sessio sessio) {
        int opcio;

        System.out.print("[?] Vols modificar l'Obra? ('s' per modificar, qualsevol altre per no modificar): ");
        if (teclat.next().equalsIgnoreCase("s") && !obres.isEmpty()) {
            mostrarObres();
            System.out.print("[?] Escull una nova Obra: ");
            opcio = teclat.nextInt();
            if (opcio <= 0 || opcio > obres.size())
                System.out.println("[!] L'Obra no s'ha modificat");
            else {
                sessio.setObra(obres.get(opcio));
                System.out.println("[i] Obra canviada a " + obres.get(opcio).getTitol());
            }
        }
        System.out.println();

        System.out.print("[?] Vols modificar el preu? ('s' per modificar, qualsevol altre per no modificar): ");
        if (teclat.next().equalsIgnoreCase("s")) {
            System.out.print("[?] Escull el nou preu: ");
            sessio.setPreu(teclat.nextDouble());
        }
        System.out.println();

        System.out.print("[?] Vols modificar l'hora? ('s' per modificar, qualsevol altre per no modificar): ");
        if (teclat.next().equalsIgnoreCase("s")) {
            System.out.print("[?] Escull una nova hora: ");
            sessio.setHora(teclat.next());
        }
        System.out.println();

        System.out.print("[?] Vols modificar el dia? ('s' per modificar, qualsevol altre per no modificar): ");
        if (teclat.next().equalsIgnoreCase("s")) {
            System.out.print("[?] Escull un nou dia: ");
            sessio.setDia(teclat.next());
        }
        System.out.println();
    }

    private static void modificarObra(Obra obra) {
        System.out.print("[?] Vols modificar el títol? ('s' per modificar, qualsevol altre per no modificar): ");
        if (teclat.next().equalsIgnoreCase("s")) {
            System.out.print("[?] Escull el nou títol: ");
            obra.setTitol(teclat.next());
        }
        System.out.println();

        System.out.print("[?] Vols modificar la durada? ('s' per modificar, qualsevol altre per no modificar): ");
        if (teclat.next().equalsIgnoreCase("s")) {
            System.out.print("[?] Escull una nova durada: ");
            obra.setDurada(teclat.nextInt());
        }
        System.out.println();

        System.out.print("[?] Vols modificar l'autor? ('s' per modificar, qualsevol altre per no modificar): ");
        if (teclat.next().equalsIgnoreCase("s")) {
            System.out.print("[?] Escull un nou autor: ");
            obra.setAutor(teclat.next());
        }
        System.out.println();

        System.out.print(
                "[?] Vols modificar el tipus de públic admès (+18 o -18)? ('s' per modificar, qualsevol altre per no modificar): ");
        if (teclat.next().equalsIgnoreCase("s")) {
            System.out.print("[?] Entra 's' per canviar l'Obra a +18, qualsevol altre per al cas contrari: ");
            if (teclat.next().equalsIgnoreCase("s"))
                obra.setEdat(true);
            else
                obra.setEdat(false);
        }
        System.out.println();
    }

    private static Espectador registrarEspectador() {
        String nom;
        int edat, min_diners = 5, max_diners = 60;
        double diners;

        System.out.print("[?] Indica el nom de l'Espectador: ");
        nom = teclat.next();
        System.out.println();
        System.out.print("[?] Indica l'edat de l'Espectador: ");
        edat = teclat.nextInt();
        System.out.println();
        diners = (double) Math.floor(Math.random() * (max_diners - min_diners + 1) + min_diners);
        System.out.print("[i] " + nom + " ha indicat que té un total de " + diners + "€");
        System.out.println();

        Espectador espectador = new Espectador(nom, edat, diners);
        espectadors.add(espectador);

        return espectador;
    }

    private static void assignarEspectador(Sessio sessio, Espectador espectador, int filera, int butaca) {
        if (sessio.potEntrar(sessio.getObra(), espectador)) {
            if (sessio.assignarSeient(espectador, filera, butaca)) {
                System.out.println("[i] " + espectador.getNom() + " ha estat assignat a la Filera " + filera
                        + " i Butaca " + butaca);
            } else {
                System.out.println("[!] La Filera " + filera + " i Butaca " + butaca
                        + " ja està assignada a l'Espectador " + sessio.getSeients()[filera][butaca].getNom());
                System.out.println(
                        "[!] No s'ha pogut assignar l'Espectador per falta d'espai o per no assolir els requeriments de la Sessió");
            }
        }
    }
}
